<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Witch's Finger</title>
<style>
  
  html,body {
    width: 100%;
    margin:0;
    background-color: #000;
  }
   
  .wrap {
    min-height: 100%;
    overflow: hidden;
    display: grid;
    place-items: center;
    gap: 16px;
    padding: 0;
    box-sizing: border-box;
    text-align: center;
  }
  /* 画像コンテナ（回転の基準にする） */
  .spin-target {
    width: 100vw;
    height: 90vh;
    overflow: hidden;
    aspect-ratio: 1 / 1;
    position: relative;
    display: grid;
    place-items: center;
    border-radius: 0;
    outline: none; /* キーボード操作時は下のfocusで表示 */
    cursor: pointer;
    user-select: none;
  }
  .img {
    width: 160%;
    height: 160%;
    transform-origin: center center;
    object-fit: contain;
    will-change: transform;
  }
   

</style>
</head>
<body>
    <main class="wrap">
    <div
      id="spinTarget"
      class="spin-target"
      role="button"
      tabindex="0"
      aria-label="画像。クリックまたはスペース/エンターで回転開始。">
      <img id="randomImg" class="img" alt="画像">
    </div>

  </main>

  <script>
    // ===== 設定（必要に応じて調整） =====
    const MIN_DEG_PER_SEC = 40;   // 最小回転速度（度/秒）
    const MAX_DEG_PER_SEC = 720;  // 最大回転速度（度/秒）
    const MIN_CHANGE_MS   = 400;  // 速度/向きを変える最短間隔
    const MAX_CHANGE_MS   = 2000; // 速度/向きを変える最長間隔
    const MIN_STOP_MS     = 6000; // 停止までの最短時間
    const MAX_STOP_MS     = 9000; // 停止までの最長時間

    // ===== 要素取得 =====
    const target = document.getElementById('spinTarget');
    const imgEl  = target.querySelector('.img');
    const images = ["tool2/witch.png", "tool2/oni.png", "tool2/pirates.png"];

    const randomSrc = images[Math.floor(Math.random() * images.length)];
    document.getElementById("randomImg").src = randomSrc;

    // ===== 内部状態 =====
    let spinning = false;
    let angleDeg = 0;
    let velDegPerSec = 0;
    let rafId = null;
    let changeTimer = null;
    let stopTimer = null;
    let lastTime = 0;

    // ユーティリティ：範囲ランダム
    const rand = (min, max) => Math.random() * (max - min) + min;
    const randInt = (min, max) => Math.floor(rand(min, max));

    // 新しい角速度をランダム選択（向きもランダム）
    function pickVelocity() {
      const speed = rand(MIN_DEG_PER_SEC, MAX_DEG_PER_SEC);
      const dir = Math.random() < 0.5 ? -1 : 1;
      return speed * dir;
    }

    // 速度/向きの変更を次回予約
    function scheduleChange() {
      clearTimeout(changeTimer);
      const wait = randInt(MIN_CHANGE_MS, MAX_CHANGE_MS + 1);
      changeTimer = setTimeout(() => {
        if (!spinning) return;
        velDegPerSec = pickVelocity();
        scheduleChange();
      }, wait);
    }

    // 回転を開始
    function startSpin() {
      if (spinning) return; // 回転中の連打は無視
      spinning = true;
      velDegPerSec = pickVelocity();
      lastTime = performance.now();

      // 停止タイマーをセット（5〜9秒で停止）
      clearTimeout(stopTimer);
      const stopIn = randInt(MIN_STOP_MS, MAX_STOP_MS + 1);
      stopTimer = setTimeout(stopSpin, stopIn);

      // 速度変更スケジューラ開始
      scheduleChange();

      // アニメーションループ
      const tick = (now) => {
        if (!spinning) return;
        const dt = (now - lastTime) / 1000; // 秒
        lastTime = now;
        angleDeg = (angleDeg + velDegPerSec * dt) % 360;
        imgEl.style.transform = `rotate(${angleDeg}deg)`;
        rafId = requestAnimationFrame(tick);
      };
      rafId = requestAnimationFrame(tick);
    }

    // 回転を停止
    function stopSpin() {
      spinning = false;
      if (rafId) cancelAnimationFrame(rafId);
      clearTimeout(changeTimer);
      clearTimeout(stopTimer);
    }

    // 入力ハンドラ（クリック、Enter/Space）
    target.addEventListener('click', startSpin);
    target.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        startSpin();
      }
    });

    // アクセシビリティ補助：初期フォーカス
    window.addEventListener('load', () => {
      target.focus({preventScroll:true});
    });


</script>
</body>
</html>
